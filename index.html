<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern E-Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    :root {
      --primary: #3a86ff;
      --primary-light: #61a0ff;
      --secondary: #ff006e;
      --text: #1a1a1a;
      --text-light: #6e6e6e;
      --background: #f8f9fa;
      --card: #ffffff;
      --card-shadow: rgba(0, 0, 0, 0.05);
      --border: #e9ecef;
      --highlight-yellow: rgba(255, 220, 0, 0.3);
      --highlight-green: rgba(114, 242, 144, 0.3);
      --highlight-blue: rgba(99, 179, 237, 0.3);
      --highlight-pink: rgba(237, 100, 166, 0.3);
      --success: #2ecc71;
      --error: #e74c3c;
      --transition: all 0.3s ease;
      --radius: 12px;
      --radius-sm: 8px;
      --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    .dark-theme {
      --primary: #4895ef;
      --primary-light: #4cc9f0;
      --secondary: #ff006e;
      --text: #f8f9fa;
      --text-light: #ced4da;
      --background: #121212;
      --card: #1e1e1e;
      --card-shadow: rgba(0, 0, 0, 0.3);
      --border: #333333;
      --highlight-yellow: rgba(255, 220, 0, 0.25);
      --highlight-green: rgba(114, 242, 144, 0.25);
      --highlight-blue: rgba(99, 179, 237, 0.25);
      --highlight-pink: rgba(237, 100, 166, 0.25);
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font);
      background-color: var(--background);
      color: var(--text);
      margin: 0;
      padding: 0;
      transition: var(--transition);
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    h1, h2, h3, h4, h5, h6 {
      margin: 0;
      line-height: 1.2;
      font-weight: 600;
    }

    button {
      cursor: pointer;
      font-family: var(--font);
      font-size: 0.9rem;
      border: none;
      background: none;
      color: var(--text);
      transition: var(--transition);
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    button:focus, input:focus, textarea:focus {
      outline: none;
    }

    /* App Container */
    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    /* App Header */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background-color: var(--card);
      border-bottom: 1px solid var(--border);
      z-index: 100;
      position: relative;
    }

    .app-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .icon-btn {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      background-color: var(--background);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:active {
      transform: scale(0.95);
      background-color: var(--border);
    }

    .icon-btn svg {
      width: 1.25rem;
      height: 1.25rem;
    }

    /* Main Content */
    .main-content {
      display: flex;
      height: calc(100% - 60px);
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    /* Library Panel */
    .library-panel {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: var(--card);
      display: flex;
      flex-direction: column;
      z-index: 50;
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .library-panel.active {
      transform: translateX(0);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .panel-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .book-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .book-card {
      background-color: var(--card);
      border-radius: var(--radius-sm);
      box-shadow: 0 2px 10px var(--card-shadow);
      overflow: hidden;
      transition: var(--transition);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      height: 220px;
    }

    .book-card:active {
      transform: scale(0.98);
    }

    .book-cover {
      height: 160px;
      background-color: var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .book-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .book-cover-placeholder {
      width: 3rem;
      height: 3rem;
      color: var(--text-light);
    }

    .book-info {
      padding: 0.5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .book-title {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .book-author {
      font-size: 0.8rem;
      color: var(--text-light);
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .progress-bar {
      height: 3px;
      background-color: var(--border);
      margin-top: auto;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background-color: var(--primary);
      width: 0%;
    }

    /* Reader Panel */
    .reader-panel {
      flex-grow: 1;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Reader Toolbar */
    .reader-toolbar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background-color: var(--card);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      border-bottom: 1px solid var(--border);
      transform: translateY(-100%);
      transition: transform 0.3s ease;
      z-index: 10;
    }

    .reader-toolbar.visible {
      transform: translateY(0);
    }

    .toolbar-center {
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chapter-title {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-light);
      text-align: center;
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Page content */
    .page-container {
      flex-grow: 1;
      height: 100%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 1rem;
      position: relative;
    }

    .page-content {
      max-width: 700px;
      margin: 0 auto;
      padding: 1rem;
    }

    .page-content p {
      margin-bottom: 1rem;
      line-height: 1.6;
      font-size: 1.1rem;
    }

    .page-content h2 {
      margin: 1.5rem 0 1rem;
      font-size: 1.5rem;
    }

    /* Selected paragraph */
    p.selected {
      border: 2px dashed var(--primary);
      padding: 0.5rem;
      border-radius: var(--radius-sm);
    }

    /* Highlight styles */
    .highlight-yellow {
      background-color: var(--highlight-yellow);
    }

    .highlight-green {
      background-color: var(--highlight-green);
    }

    .highlight-blue {
      background-color: var(--highlight-blue);
    }

    .highlight-pink {
      background-color: var(--highlight-pink);
    }

    /* Bottom Toolbar */
    .bottom-toolbar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background-color: var(--card);
      display: flex;
      align-items: center;
      justify-content: space-around;
      border-top: 1px solid var(--border);
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 10;
    }

    .bottom-toolbar.visible {
      transform: translateY(0);
    }

    .page-indicator {
      font-size: 0.8rem;
      color: var(--text-light);
    }

    /* Highlight Menu */
    .highlight-menu {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--card);
      padding: 1rem;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
      box-shadow: 0 -2px 10px var(--card-shadow);
      z-index: 100;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .highlight-menu.active {
      display: block;
      transform: translateY(0);
    }

    .menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .menu-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .close-btn {
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .color-options {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1rem;
    }

    .color-option {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      border: 2px solid transparent;
      transition: var(--transition);
    }

    .color-option.selected {
      border-color: var(--text);
      transform: scale(1.1);
    }

    .note-container {
      margin-bottom: 1rem;
    }

    .note-label {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      display: block;
      color: var(--text-light);
    }

    .note-input {
      width: 100%;
      min-height: 80px;
      padding: 0.75rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background-color: var(--background);
      color: var(--text);
      font-family: var(--font);
      font-size: 0.9rem;
      resize: none;
    }

    .menu-buttons {
      display: flex;
      gap: 1rem;
    }

    .menu-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: var(--radius-sm);
      text-align: center;
      font-weight: 500;
    }

    .primary-btn {
      background-color: var(--primary);
      color: white;
    }

    .secondary-btn {
      background-color: var(--background);
      color: var(--text);
      border: 1px solid var(--border);
    }

    /* Highlights View */
    .highlights-view {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--card);
      z-index: 50;
      display: none;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .highlights-view.active {
      display: flex;
    }

    .highlights-list {
      padding: 1rem;
    }

    .highlight-item {
      background-color: var(--background);
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }

    .highlight-text {
      margin-bottom: 0.5rem;
      font-style: italic;
      line-height: 1.4;
    }

    .highlight-note {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background-color: rgba(0, 0, 0, 0.03);
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
    }

    .highlight-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .highlight-btn {
      padding: 0.5rem;
      font-size: 0.8rem;
      border-radius: var(--radius-sm);
      background-color: var(--card);
      border: 1px solid var(--border);
    }

    .edit-note-btn {
      color: var(--primary);
    }

    .delete-highlight-btn {
      color: var(--secondary);
    }

    .no-highlights {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
    }

    /* Settings Panel */
    .settings-panel {
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background-color: var(--card);
      z-index: 60;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .settings-panel.active {
      transform: translateX(0);
    }

    .settings-section {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-light);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .setting-row:last-child {
      margin-bottom: 0;
    }

    .setting-label {
      font-size: 1rem;
    }

    /* Font size controls */
    .font-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .font-size-btn {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      background-color: var(--background);
      font-weight: bold;
      font-size: 1rem;
    }

    .font-size-value {
      min-width: 2.5rem;
      text-align: center;
      font-size: 0.9rem;
    }

    /* Toggle */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 3rem;
      height: 1.5rem;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: var(--transition);
      border-radius: 1rem;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 1.1rem;
      width: 1.1rem;
      left: 0.2rem;
      bottom: 0.2rem;
      background-color: white;
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--primary);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(1.5rem);
    }

    /* Custom theme colors */
    .theme-colors {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .theme-color {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
    }

    .theme-color.selected {
      border-color: var(--text);
      transform: scale(1.1);
    }

    /* Table of Contents panel */
    .toc-panel {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: var(--card);
      z-index: 50;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .toc-panel.active {
      transform: translateX(0);
    }

    .toc-list {
      list-style-type: none;
    }

    .toc-item {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
    }

    .toc-item.active {
      background-color: rgba(58, 134, 255, 0.1);
      border-left: 3px solid var(--primary);
    }

    /* Search panel */
    .search-panel {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: var(--card);
      z-index: 50;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .search-panel.active {
      transform: translateX(0);
    }

    .search-form {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background-color: var(--card);
      z-index: 5;
    }

    .search-input-container {
      position: relative;
      display: flex;
      margin-bottom: 0.5rem;
    }

    .search-input {
      flex-grow: 1;
      padding: 0.75rem 2.5rem 0.75rem 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background-color: var(--background);
      color: var(--text);
      font-family: var(--font);
      font-size: 1rem;
    }

    .search-btn {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      padding: 0.5rem;
    }

    .search-results {
      padding: 1rem;
    }

    .search-result {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
    }

    .search-highlight {
      background-color: var(--highlight-yellow);
      padding: 0.1rem 0;
    }

    .no-results {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--card);
      color: var(--text);
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      font-size: 0.9rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      visibility: visible;
    }

    /* Modal overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 90;
      display: none;
    }

    .modal-overlay.active {
      display: block;
    }

    /* Bottom sheet for iOS-style modals */
    .bottom-sheet {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--card);
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
      z-index: 100;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 1rem;
      box-shadow: 0 -2px 10px var(--card-shadow);
    }

    .bottom-sheet.active {
      transform: translateY(0);
    }

    .sheet-drag-handle {
      width: 4rem;
      height: 4px;
      background-color: var(--border);
      border-radius: 2px;
      margin: 0 auto 1rem;
    }

    /* Loaders */
    .loader {
      display: inline-block;
      width: 1.5rem;
      height: 1.5rem;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* For iOS safe areas */
    @supports (padding-top: env(safe-area-inset-top)) {
      .app-header {
        padding-top: calc(1rem + env(safe-area-inset-top));
      }
      
      .bottom-toolbar {
        padding-bottom: env(safe-area-inset-bottom);
        height: calc(60px + env(safe-area-inset-bottom));
      }
      
      .highlight-menu {
        padding-bottom: calc(1rem + env(safe-area-inset-bottom));
      }
      
      .bottom-sheet {
        padding-bottom: calc(1rem + env(safe-area-inset-bottom));
      }
    }

    /* Responsive styles for larger screens */
    @media (min-width: 768px) {
      .library-panel, .settings-panel, .toc-panel, .search-panel {
        max-width: 400px;
      }
      
      .highlight-menu {
        max-width: 500px;
        left: 50%;
        transform: translateX(-50%) translateY(100%);
        border-radius: var(--radius);
      }
      
      .highlight-menu.active {
        transform: translateX(-50%) translateY(0);
        bottom: 2rem;
      }
      
      .book-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- App Header -->
    <div class="app-header">
      <button id="library-btn" class="icon-btn" aria-label="Library">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
      </button>
      <div class="app-title">Modern E-Reader</div>
      <button id="settings-btn" class="icon-btn" aria-label="Settings">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82 1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Library Panel (slide in from left) -->
      <div id="library-panel" class="library-panel">
        <div class="panel-header">
          <div class="panel-title">My Library</div>
          <button id="close-library-btn" class="icon-btn" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div id="book-grid" class="book-grid">
          <!-- Books will be populated here from library.json -->
          <div class="loader-container" style="display: flex; justify-content: center; padding: 2rem;">
            <div class="loader"></div>
          </div>
        </div>
      </div>

      <!-- Reader Panel -->
      <div class="reader-panel">
        <!-- Top Toolbar (slides down on tap) -->
        <div id="reader-toolbar" class="reader-toolbar">
          <button id="back-btn" class="icon-btn" aria-label="Back">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <div class="toolbar-center">
            <div id="chapter-title" class="chapter-title">Chapter 1</div>
          </div>
          <button id="toc-btn" class="icon-btn" aria-label="Table of Contents">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
        </div>

        <!-- Page Container -->
        <div id="page-container" class="page-container">
          <div class="page-content">
            <h2>Welcome to your Modern E-Reader</h2>
            <p data-index="0">This is a modern, mobile-optimized e-reader designed for iOS and Android devices. Tap anywhere on the screen to show or hide the toolbars.</p>
            <p data-index="1">Your e-reader connects directly to your library stored in /ebooks/library.json, making it easy to access all your books in one place.</p>
            <p data-index="2">This reader features a highlighting system that lets you mark important passages with different colors. You can also add notes to your highlights for reference later.</p>
            <p data-index="3">To try the highlighting feature, first tap the screen to show the toolbars, then use the highlight button at the bottom of the screen. After that, tap on any paragraph to select it for highlighting.</p>
            <p data-index="4">Other features include night mode for comfortable reading in low light, adjustable font sizes, line spacing options, and customizable themes to match your preferences.</p>
            <p data-index="5">Your reading progress is automatically saved, so you can always pick up where you left off. The reader also tracks your reading statistics to help you monitor your reading habits.</p>
            <p data-index="6">The search function helps you find specific content within your current book. Just tap the search icon in the top toolbar to get started.</p>
            <p data-index="7">You can navigate between chapters using the table of contents. Access it by tapping the menu icon in the top toolbar.</p>
            <p data-index="8">All your highlights and notes are organized in one place. View them by tapping the highlights button in the bottom toolbar.</p>
            <p data-index="9">To start reading, open the library panel by tapping the book icon in the top-left corner, then select a book from your collection.</p>
          </div>
        </div>

        <!-- Bottom Toolbar (slides up on tap) -->
        <div id="bottom-toolbar" class="bottom-toolbar">
          <button id="highlight-btn" class="icon-btn" aria-label="Highlight">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button id="view-highlights-btn" class="icon-btn" aria-label="View Highlights">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
          </button>
          <div class="page-indicator">Page 1 of 10</div>
          <button id="search-btn" class="icon-btn" aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
          <button id="font-btn" class="icon-btn" aria-label="Font Settings">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="4 7 4 4 20 4 20 7"></polyline>
              <line x1="9" y1="20" x2="15" y2="20"></line>
              <line x1="12" y1="4" x2="12" y2="20"></line>
            </svg>
          </button>
        </div>

        <!-- Highlight Menu (slides up from bottom) -->
        <div id="highlight-menu" class="highlight-menu">
          <div class="menu-header">
            <div class="menu-title">Create Highlight</div>
            <button id="close-highlight-menu-btn" class="close-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="color-options">
            <div class="color-option selected" style="background-color: var(--highlight-yellow);" data-color="yellow"></div>
            <div class="color-option" style="background-color: var(--highlight-green);" data-color="green"></div>
            <div class="color-option" style="background-color: var(--highlight-blue);" data-color="blue"></div>
            <div class="color-option" style="background-color: var(--highlight-pink);" data-color="pink"></div>
          </div>
          <div class="note-container">
            <label for="note-input" class="note-label">Add a note (optional):</label>
            <textarea id="note-input" class="note-input" placeholder="Enter your note here..."></textarea>
          </div>
          <div class="menu-buttons">
            <button id="save-highlight-btn" class="menu-btn primary-btn">Save Highlight</button>
            <button id="cancel-highlight-btn" class="menu-btn secondary-btn">Cancel</button>
          </div>
        </div>

        <!-- Highlights View -->
        <div id="highlights-view" class="highlights-view">
          <div class="panel-header">
            <div class="panel-title">My Highlights and Notes</div>
            <button id="close-highlights-btn" class="icon-btn" aria-label="Close">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div id="highlights-list" class="highlights-list">
            <div id="no-highlights-message" class="no-highlights">
              No highlights yet. Use highlight mode to create some!
            </div>
            <!-- Highlights will be populated here -->
          </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel">
          <div class="panel-header">
            <div class="panel-title">Settings</div>
            <button id="close-settings-btn" class="icon-btn" aria-label="Close">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          
          <div class="settings-section">
            <div class="section-title">Display</div>
            <div class="setting-row">
              <span class="setting-label">Font Size</span>
              <div class="font-controls">
                <button id="decrease-font-btn" class="font-size-btn">-</button>
                <span id="font-size-value" class="font-size-value">16px</span>
                <button id="increase-font-btn" class="font-size-btn">+</button>
              </div>
            </div>
            <div class="setting-row">
              <span class="setting-label">Line Height</span>
              <div class="font-controls">
                <button id="decrease-line-height-btn" class="font-size-btn">-</button>
                <span id="line-height-value" class="font-size-value">1.6</span>
                <button id="increase-line-height-btn" class="font-size-btn">+</button>
              </div>
            </div>
          </div>
          
          <div class="settings-section">
            <div class="section-title">Theme</div>
            <div class="setting-row">
              <span class="setting-label">Dark Mode</span>
              <label class="toggle-switch">
                <input type="checkbox" id="dark-mode-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <span class="setting-label">Theme Color</span>
              <div class="theme-colors">
                <div class="theme-color selected" style="background-color: #3a86ff;" data-color="#3a86ff"></div>
                <div class="theme-color" style="background-color: #ff006e;" data-color="#ff006e"></div>
                <div class="theme-color" style="background-color: #8338ec;" data-color="#8338ec"></div>
                <div class="theme-color" style="background-color: #fb5607;" data-color="#fb5607"></div>
                <div class="theme-color" style="background-color: #06d6a0;" data-color="#06d6a0"></div>
              </div>
            </div>
          </div>
          
          <div class="settings-section">
            <div class="section-title">Reading</div>
            <div class="setting-row">
              <span class="setting-label">Auto-Scroll</span>
              <label class="toggle-switch">
                <input type="checkbox" id="auto-scroll-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <span class="setting-label">Keep Screen On</span>
              <label class="toggle-switch">
                <input type="checkbox" id="keep-screen-on-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Table of Contents Panel -->
        <div id="toc-panel" class="toc-panel">
          <div class="panel-header">
            <div class="panel-title">Table of Contents</div>
            <button id="close-toc-btn" class="icon-btn" aria-label="Close">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <ul id="toc-list" class="toc-list">
            <!-- TOC items will be populated here -->
            <li class="toc-item active">Chapter 1: Introduction</li>
            <li class="toc-item">Chapter 2: Getting Started</li>
            <li class="toc-item">Chapter 3: Advanced Features</li>
          </ul>
        </div>

        <!-- Search Panel -->
        <div id="search-panel" class="search-panel">
          <div class="panel-header">
            <div class="panel-title">Search</div>
            <button id="close-search-btn" class="icon-btn" aria-label="Close">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="search-form">
            <div class="search-input-container">
              <input type="text" id="search-input" class="search-input" placeholder="Search in book...">
              <button id="do-search-btn" class="search-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
              </button>
            </div>
          </div>
          <div id="search-results" class="search-results">
            <div class="no-results">
              Enter a search term above to find text in this book.
            </div>
            <!-- Search results will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast"></div>

  <!-- Modal Overlay -->
  <div id="modal-overlay" class="modal-overlay"></div>

  <script>
    // DOM Elements
    const app = document.getElementById('app');
    const libraryPanel = document.getElementById('library-panel');
    const libraryBtn = document.getElementById('library-btn');
    const closeLibraryBtn = document.getElementById('close-library-btn');
    const bookGrid = document.getElementById('book-grid');
    
    const readerToolbar = document.getElementById('reader-toolbar');
    const bottomToolbar = document.getElementById('bottom-toolbar');
    const pageContainer = document.getElementById('page-container');
    const paragraphs = document.querySelectorAll('.page-content p');
    const pageIndicator = document.querySelector('.page-indicator');
    
    const settingsPanel = document.getElementById('settings-panel');
    const settingsBtn = document.getElementById('settings-btn');
    const closeSettingsBtn = document.getElementById('close-settings-btn');
    
    const highlightBtn = document.getElementById('highlight-btn');
    const highlightMenu = document.getElementById('highlight-menu');
    const closeHighlightMenuBtn = document.getElementById('close-highlight-menu-btn');
    const saveHighlightBtn = document.getElementById('save-highlight-btn');
    const cancelHighlightBtn = document.getElementById('cancel-highlight-btn');
    const colorOptions = document.querySelectorAll('.color-option');
    const noteInput = document.getElementById('note-input');
    
    const viewHighlightsBtn = document.getElementById('view-highlights-btn');
    const highlightsView = document.getElementById('highlights-view');
    const closeHighlightsBtn = document.getElementById('close-highlights-btn');
    const highlightsList = document.getElementById('highlights-list');
    const noHighlightsMessage = document.getElementById('no-highlights-message');
    
    const decreaseFontBtn = document.getElementById('decrease-font-btn');
    const increaseFontBtn = document.getElementById('increase-font-btn');
    const fontSizeValue = document.getElementById('font-size-value');
    
    const decreaseLineHeightBtn = document.getElementById('decrease-line-height-btn');
    const increaseLineHeightBtn = document.getElementById('increase-line-height-btn');
    const lineHeightValue = document.getElementById('line-height-value');
    
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const themeColors = document.querySelectorAll('.theme-color');
    
    const tocBtn = document.getElementById('toc-btn');
    const tocPanel = document.getElementById('toc-panel');
    const closeTocBtn = document.getElementById('close-toc-btn');
    const tocList = document.getElementById('toc-list');
    
    const searchBtn = document.getElementById('search-btn');
    const searchPanel = document.getElementById('search-panel');
    const closeSearchBtn = document.getElementById('close-search-btn');
    const searchInput = document.getElementById('search-input');
    const doSearchBtn = document.getElementById('do-search-btn');
    const searchResults = document.getElementById('search-results');
    
    const toast = document.getElementById('toast');
    const modalOverlay = document.getElementById('modal-overlay');
    
    // Global Variables
    let highlightMode = false;
    let selectedParagraph = null;
    let selectedColor = 'yellow';
    let highlights = [];
    let toolbarsVisible = false;
    let currentBook = null;
    let library = [];
    let fontSize = 16;
    let lineHeight = 1.6;
    let primaryColor = '#3a86ff';
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
      loadHighlights();
      fetchLibrary();
      initEvents();
    });
    
    // Fetch Library JSON
    function fetchLibrary() {
      fetch('/ebooks/library.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          library = data.books || [];
          populateLibrary();
        })
        .catch(error => {
          console.error('Error fetching library:', error);
          showToast('Failed to load library. Please try again later.');
          
          // Load sample books if library.json fails
          library = [
            {
              id: 'sample1',
              title: 'Sample Book 1',
              author: 'John Author',
              cover: null,
              progress: 35
            },
            {
              id: 'sample2',
              title: 'The Great Adventure',
              author: 'Jane Writer',
              cover: null,
              progress: 12
            },
            {
              id: 'sample3',
              title: 'Mystery of the Lost Key',
              author: 'Arthur Mystery',
              cover: null,
              progress: 68
            }
          ];
          populateLibrary();
        });
    }
    
    // Populate Library
    function populateLibrary() {
      bookGrid.innerHTML = '';
      
      if (library.length === 0) {
        const noBooks = document.createElement('div');
        noBooks.className = 'no-highlights';
        noBooks.textContent = 'No books found in your library.';
        bookGrid.appendChild(noBooks);
        return;
      }
      
      library.forEach(book => {
        const bookCard = document.createElement('div');
        bookCard.className = 'book-card';
        bookCard.dataset.id = book.id;
        
        const coverEl = document.createElement('div');
        coverEl.className = 'book-cover';
        
        if (book.cover) {
          const img = document.createElement('img');
          img.src = book.cover;
          img.alt = book.title;
          coverEl.appendChild(img);
        } else {
          // Placeholder icon
          coverEl.innerHTML = `
            <svg class="book-cover-placeholder" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
          `;
        }
        
        const infoEl = document.createElement('div');
        infoEl.className = 'book-info';
        
        const titleEl = document.createElement('div');
        titleEl.className = 'book-title';
        titleEl.textContent = book.title;
        
        const authorEl = document.createElement('div');
        authorEl.className = 'book-author';
        authorEl.textContent = book.author || 'Unknown Author';
        
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        
        const progressFill = document.createElement('div');
        progressFill.className = 'progress-fill';
        progressFill.style.width = `${book.progress || 0}%`;
        
        progressBar.appendChild(progressFill);
        infoEl.appendChild(titleEl);
        infoEl.appendChild(authorEl);
        infoEl.appendChild(progressBar);
        
        bookCard.appendChild(coverEl);
        bookCard.appendChild(infoEl);
        
        // Book card click event
        bookCard.addEventListener('click', () => {
          currentBook = book;
          loadBook(book);
          closeLibraryPanel();
        });
        
        bookGrid.appendChild(bookCard);
      });
    }
    
    // Load Book
    function loadBook(book) {
      // In a real app, this would load actual book content
      showToast(`Loading book: ${book.title}`);
      
      // Update UI to reflect current book
      document.querySelector('.app-title').textContent = book.title;
      // More book loading logic would go here
    }
    
    // Initialize Event Listeners
    function initEvents() {
      // Library panel toggle
      libraryBtn.addEventListener('click', openLibraryPanel);
      closeLibraryBtn.addEventListener('click', closeLibraryPanel);
      
      // Settings panel toggle
      settingsBtn.addEventListener('click', openSettingsPanel);
      closeSettingsBtn.addEventListener('click', closeSettingsPanel);
      
      // Reader toolbar visibility
      pageContainer.addEventListener('click', toggleToolbars);
