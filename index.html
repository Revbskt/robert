<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ePub Reader with Highlights</title>
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no" />

  <style>
    /* Global Styles */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background: #f5f5f5;
    }

    /* Container styles */
    #app {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Book display */
    #book-content {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      background: white;
      margin-top: 20px;
      position: relative;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: #eee;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .toolbar button {
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .toolbar button.active {
      background: #ffcc00;
    }

    /* Highlight styles */
    .highlight-yellow {
      background-color: rgba(255, 255, 0, 0.4);
      border-radius: 4px;
      padding: 8px;
      margin: 10px 0;
      position: relative;
    }
    
    .highlight-green {
      background-color: rgba(0, 255, 0, 0.25);
      border-radius: 4px;
      padding: 8px;
      margin: 10px 0;
      position: relative;
    }
    
    .highlight-blue {
      background-color: rgba(0, 200, 255, 0.25);
      border-radius: 4px;
      padding: 8px;
      margin: 10px 0;
      position: relative;
    }
    
    .highlight-pink {
      background-color: rgba(255, 105, 180, 0.25);
      border-radius: 4px;
      padding: 8px;
      margin: 10px 0;
      position: relative;
    }

    /* Paragraph styles */
    p {
      line-height: 1.6;
      margin: 10px 0;
    }

    p.selected {
      border: 2px dashed #666;
      border-radius: 4px;
      padding: 8px;
    }

    /* Highlight Menu */
    #highlight-menu {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      padding: 20px;
      z-index: 1000;
      display: none;
    }

    .highlight-menu-title {
      text-align: center;
      margin-top: 0;
      margin-bottom: 15px;
    }

    .color-options {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
    }

    .color-option.selected {
      border: 3px solid #333;
    }

    #note-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 15px;
      height: 80px;
    }

    .highlight-actions {
      display: flex;
      justify-content: space-between;
    }

    .highlight-actions button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #apply-highlight {
      background: #4CAF50;
      color: white;
    }

    #cancel-highlight {
      background: #f5f5f5;
    }

    /* Note display */
    .note-display {
      margin-top: 8px;
      padding: 8px;
      background: #f9f9f9;
      border-left: 3px solid #ffcc00;
      font-style: italic;
    }

    /* Note icon */
    .has-note:after {
      content: "üìù";
      position: absolute;
      top: 5px;
      right: 5px;
    }

    /* Highlights list */
    #highlights-list {
      margin-top: 30px;
      border-top: 2px solid #eee;
      padding-top: 20px;
    }

    .highlight-item {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      position: relative;
    }

    .highlight-text {
      font-style: italic;
    }

    .highlight-note {
      margin-top: 5px;
      font-size: 14px;
      color: #666;
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>ePub Reader with Highlighting</h1>
    
    <!-- Toolbar -->
    <div class="toolbar">
      <button id="toggle-highlights-list">View Highlights</button>
      <button id="highlight-mode-toggle">Highlight Mode</button>
    </div>
    
    <!-- Book Content -->
    <div id="book-content">
      <h2>Demo Book</h2>
      <p>This is the first paragraph of the demo book. You can tap on this paragraph when highlight mode is active to highlight it.</p>
      <p>This is the second paragraph. The highlighting feature works by selecting entire paragraphs, which works well on mobile devices where precise text selection can be difficult.</p>
      <p>This is the third paragraph. You can choose from multiple highlight colors and all your highlights will be saved between sessions.</p>
      <p>This is another paragraph. Try the highlight button in the toolbar and then tap on this paragraph.</p>
      <p>When you activate highlight mode, tapping on any paragraph will select it. A menu will appear with color options.</p>
      <p>After selecting a color, click the "Highlight" button to apply the highlight to the paragraph.</p>
      <p>You can view all your highlights by clicking the View Highlights button, and you can see your notes directly attached to the highlighted text.</p>
    </div>
    
    <!-- Highlights List (Initially Hidden) -->
    <div id="highlights-list" style="display:none;">
      <h2>My Highlights and Notes</h2>
      <div id="highlights-container">
        <!-- Highlights will be populated here -->
        <p>No highlights yet. Use highlight mode to create some!</p>
      </div>
    </div>
    
    <!-- Highlight Menu -->
    <div id="highlight-menu">
      <h3 class="highlight-menu-title">Create Highlight</h3>
      <div class="color-options">
        <div class="color-option selected" style="background-color:#ffff00;" data-color="yellow"></div>
        <div class="color-option" style="background-color:#00ff00;" data-color="green"></div>
        <div class="color-option" style="background-color:#00c8ff;" data-color="blue"></div>
        <div class="color-option" style="background-color:#ff69b4;" data-color="pink"></div>
      </div>
      <label for="note-input">Add a note (optional):</label>
      <textarea id="note-input" placeholder="Enter your note here..."></textarea>
      <div class="highlight-actions">
        <button id="apply-highlight">Save Highlight</button>
        <button id="cancel-highlight">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // Global Variables
    let highlightMode = false;
    let selectedParagraph = null;
    let selectedColor = "yellow";
    let highlights = JSON.parse(localStorage.getItem('bookHighlights') || '[]');
    
    // DOM Elements
    const highlightModeToggle = document.getElementById('highlight-mode-toggle');
    const paragraphs = document.querySelectorAll('#book-content p');
    const highlightMenu = document.getElementById('highlight-menu');
    const applyHighlightBtn = document.getElementById('apply-highlight');
    const cancelHighlightBtn = document.getElementById('cancel-highlight');
    const colorOptions = document.querySelectorAll('.color-option');
    const noteInput = document.getElementById('note-input');
    const toggleHighlightsList = document.getElementById('toggle-highlights-list');
    const highlightsList = document.getElementById('highlights-list');
    const highlightsContainer = document.getElementById('highlights-container');
    
    // Show toast notification
    function showToast(message, duration = 3000) {
      // Remove existing toasts
      const existingToasts = document.querySelectorAll('.toast');
      existingToasts.forEach(toast => document.body.removeChild(toast));
      
      // Create new toast
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      // Auto-remove after duration
      setTimeout(() => {
        if (document.body.contains(toast)) {
          document.body.removeChild(toast);
        }
      }, duration);
    }
    
    // Toggle highlight mode
    highlightModeToggle.addEventListener('click', () => {
      highlightMode = !highlightMode;
      highlightModeToggle.classList.toggle('active');
      
      if (highlightMode) {
        showToast('Highlight mode activated. Tap any paragraph to highlight it.');
      } else {
        showToast('Highlight mode deactivated');
        
        // Clear any selected paragraph
        if (selectedParagraph) {
          selectedParagraph.classList.remove('selected');
          selectedParagraph = null;
        }
      }
    });
    
    // Toggle highlights list
    toggleHighlightsList.addEventListener('click', () => {
      const bookContent = document.getElementById('book-content');
      
      if (highlightsList.style.display === 'none') {
        highlightsList.style.display = 'block';
        bookContent.style.display = 'none';
        toggleHighlightsList.textContent = 'Back to Book';
        updateHighlightsList();
      } else {
        highlightsList.style.display = 'none';
        bookContent.style.display = 'block';
        toggleHighlightsList.textContent = 'View Highlights';
      }
    });
    
    // Setup paragraph selection
    paragraphs.forEach((p, index) => {
      p.addEventListener('click', () => {
        if (!highlightMode) return;
        
        // Clear previous selection
        if (selectedParagraph) {
          selectedParagraph.classList.remove('selected');
        }
        
        // Select this paragraph
        selectedParagraph = p;
        p.classList.add('selected');
        
        // Show highlight menu
        highlightMenu.style.display = 'block';
        
        // Clear previous note
        noteInput.value = '';
      });
    });
    
    // Color selection
    colorOptions.forEach(option => {
      option.addEventListener('click', () => {
        // Update selected color
        selectedColor = option.getAttribute('data-color');
        
        // Update UI
        colorOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
      });
    });
    
    // Apply highlight
    applyHighlightBtn.addEventListener('click', () => {
      if (!selectedParagraph) return;
      
      // Get note text
      const note = noteInput.value.trim();
      
      // Apply highlight class
      selectedParagraph.className = `highlight-${selectedColor}`;
      selectedParagraph.classList.remove('selected');
      
      // Add note if provided
      if (note) {
        selectedParagraph.classList.add('has-note');
        
        // Remove any existing note display
        const existingNote = selectedParagraph.querySelector('.note-display');
        if (existingNote) {
          selectedParagraph.removeChild(existingNote);
        }
        
        // Add note display
        const noteDisplay = document.createElement('div');
        noteDisplay.className = 'note-display';
        noteDisplay.textContent = note;
        selectedParagraph.appendChild(noteDisplay);
      }
      
      // Save highlight
      const highlight = {
        id: Date.now(),
        text: selectedParagraph.textContent,
        color: selectedColor,
        note: note,
        paragraphIndex: Array.from(paragraphs).indexOf(selectedParagraph)
      };
      
      highlights.push(highlight);
      localStorage.setItem('bookHighlights', JSON.stringify(highlights));
      
      // Close menu and reset
      highlightMenu.style.display = 'none';
      selectedParagraph = null;
      
      // Show confirmation
      showToast(note ? 'Highlight and note saved' : 'Highlight saved');
    });
    
    // Cancel highlight
    cancelHighlightBtn.addEventListener('click', () => {
      if (selectedParagraph) {
        selectedParagraph.classList.remove('selected');
        selectedParagraph = null;
      }
      
      highlightMenu.style.display = 'none';
    });
    
    // Update highlights list
    function updateHighlightsList() {
      if (highlights.length === 0) {
        highlightsContainer.innerHTML = '<p>No highlights yet. Use highlight mode to create some!</p>';
        return;
      }
      
      highlightsContainer.innerHTML = '';
      
      highlights.forEach(highlight => {
        const item = document.createElement('div');
        item.className = `highlight-item highlight-${highlight.color}`;
        
        const text = document.createElement('div');
        text.className = 'highlight-text';
        text.textContent = highlight.text.substring(0, 100) + (highlight.text.length > 100 ? '...' : '');
        
        item.appendChild(text);
        
        if (highlight.note) {
          const noteElem = document.createElement('div');
          noteElem.className = 'highlight-note';
          noteElem.textContent = `üìù Note: ${highlight.note}`;
          item.appendChild(noteElem);
        }
        
        // Add delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.style.position = 'absolute';
        deleteBtn.style.right = '10px';
        deleteBtn.style.top = '10px';
        deleteBtn.style.background = '#ff5252';
        deleteBtn.style.color = 'white';
        deleteBtn.style.border = 'none';
        deleteBtn.style.borderRadius = '4px';
        deleteBtn.style.padding = '3px 8px';
        
        deleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          
          // Remove from storage
          highlights = highlights.filter(h => h.id !== highlight.id);
          localStorage.setItem('bookHighlights', JSON.stringify(highlights));
          
          // Remove from UI
          highlightsContainer.removeChild(item);
          
          // Remove highlight from paragraph
          if (highlight.paragraphIndex >= 0 && highlight.paragraphIndex < paragraphs.length) {
            paragraphs[highlight.paragraphIndex].className = '';
            
            // Remove note display
            const noteDisplay = paragraphs[highlight.paragraphIndex].querySelector('.note-display');
            if (noteDisplay) {
              paragraphs[highlight.paragraphIndex].removeChild(noteDisplay);
            }
          }
          
          // Update empty state if needed
          if (highlights.length === 0) {
            highlightsContainer.innerHTML = '<p>No highlights yet. Use highlight mode to create some!</p>';
          }
          
          showToast('Highlight deleted');
        });
        
        item.appendChild(deleteBtn);
        highlightsContainer.appendChild(item);
      });
    }
    
    // Load saved highlights on page load
    function loadSavedHighlights() {
      highlights.forEach(highlight => {
        if (highlight.paragraphIndex >= 0 && highlight.paragraphIndex < paragraphs.length) {
          const p = paragraphs[highlight.paragraphIndex];
          
          // Apply highlight class
          p.className = `highlight-${highlight.color}`;
          
          // Add note if exists
          if (highlight.note) {
            p.classList.add('has-note');
            
            const noteDisplay = document.createElement('div');
            noteDisplay.className = 'note-display';
            noteDisplay.textContent = highlight.note;
            p.appendChild(noteDisplay);
          }
        }
      });
    }
    
    // Initialize
    loadSavedHighlights();
  </script>
</body>
</html>
